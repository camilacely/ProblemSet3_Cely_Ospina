View(cbd_bog)
View(calle_100)
centro_inter <- geocode_OSM("Torre Colpatria, Bogotá", as.sf = T)
View(centro_inter)
centro_inter <- geocode_OSM("Torre Colpatria, Bogotá", as.sf = T)
centro_inter <- centro_inter$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=centro_inter , color="red")
av_chile <- geocode_OSM("Torre Banco de Occidente, Bogotá", as.sf = T)
av_chile <- av_chile$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=av_chile , color="red")
calle_100 <- geocode_OSM("World Trade Center, Bogotá", as.sf = T)
calle_100 <- calle_100$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=calle_100 , color="red")
cbd_bog<- rbind(centro_inter , av_chile, calle_100)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cbd_bog , color="red")
c1 <- geocode_OSM("One Plaza Business Center, Medellín", as.sf = T)
c1 <- geocode_OSM("Avenida el Poblado", as.sf = T)
c1 <- geocode_OSM("Avenida el Poblado, Medellín", as.sf = T)
View(c1)
av_poblado <- geocode_OSM("Avenida el Poblado, Medellín", as.sf = T)
View(av_poblado)
av_poblado <- geocode_OSM("Avenida el Poblado, Medellín", as.sf = T)
av_poblado <- av_poblado$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=av_poblado , color="red")
cdb_med <- geocode_OSM("Avenida el Poblado, Medellín", as.sf = T)
cdb_med <- cdb_med$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cdb_med , color="red")
cbd - rbind (cbd_bog, cbd_med)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cbd , color="red")
cbd - rbind (cbd_bog, cbd_med)
cbd <- rbind (cbd_bog, cbd_med)
cdb_med <- geocode_OSM("Avenida el Poblado, Medellín", as.sf = T)
cdb_med <- cdb_med$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cdb_med , color="red")
cbd <- rbind (cbd_bog, cbd_med)
cbd <- rbind (cbd_bog, cbd_med)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cbd , color="red")
cbd <- rbind (cbd_bog, cbd_med)
cbd_med <- geocode_OSM("Avenida el Poblado, Medellín", as.sf = T)
cbd_med <- cbd_med$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cbd_med , color="red")
cbd <- rbind (cbd_bog, cbd_med)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cbd , color="red")
dist_cbd <- st_distance(x=tt_barrios, y=cbd)
min_dist_cbd <- apply(dist_cbd,1,min)
tt_barrios$dist_cbd <- min_dist_cbd
head(tt_barrios$dist_cbd)
view((tt_barrios$dist_cbd)
view(tt_barrios$dist_cbd)
view (tt_barrios$dist_cbd)
view (tt_barrios$dist_cbd, tt_barrios$price)
view (tt_barrios$dist_cbd | tt_barrios$price)
usaquen <- geocode_OSM("Torre Samsung, Bogotá", as.sf = T)
usaquen <- usaquen$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=usaquen , color="red")
usaquen <- geocode_OSM("Torre Samsung, Bogotá", as.sf = T)
usaquen <- geocode_OSM("Torre Ar, Bogotá", as.sf = T)
usaquen <- usaquen$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=usaquen , color="red")
usaquen <- geocode_OSM("Hacienda Santa Bárbara, Bogotá", as.sf = T)
usaquen <- usaquen$point  %>% select(query)
leaflet() %>% addTiles() %>% addCircleMarkers(data=usaquen , color="red")
cbd_bog<- rbind(centro_inter , av_chile, calle_100, usaquen)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cbd_bog , color="red")
cbd <- rbind (cbd_bog, cbd_med)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cbd , color="red")
#CBD
dist_cbd <- st_distance(x=tt_barrios, y=cbd)
min_dist_cbd <- apply(dist_cbd,1,min)
tt_barrios$dist_cbd <- min_dist_cbd
head(tt_barrios$dist_cbd)
View(train_test)
tt_barrios$oriente <- tt_barrios$lon
as.numeric (tt_barrios$lon)
View(tt_barrios)
View(tt_barrios)
View(tt_barrios)
tt_lon <- select(filter(train_test),c(property_id, lon))
tt_barrios_lon <- (tt_barrios, tt_lon)
tt_barrios_lon <- left_join(tt_barrios, tt_lon)
View(tt_barrios_lon)
tt_barrios <- left_join(tt_barrios, tt_lon)
tt_barrios$oriente <- tt_barrios$lon
as.numeric (tt_barrios$oriente)
summary(tt_barrios$oriente)
hw_bog <-  opq(bbox = getbb("Bogotá Colombia")) %>%
add_osm_feature(key="highway" , value="trunk")
View(hw_bog)
hw_bog <- hw_bog %>% osmdata_sf()
hw_bog
View(hw_bog)
hw_bog <-  opq(bbox = getbb("Bogotá Colombia")) %>%
add_osm_feature(key="highway" , value="trunk")
hw_bog <- hw_bog %>% osmdata_sf()
hw_bog <- hw_bog$osm_points %>% select(osm_id)
leaflet() %>% addTiles() %>% addCircleMarkers(data=hw_bog , color="red")
View(mchap)
hw_bog_trunk <-  opq(bbox = getbb("Bogotá Colombia")) %>%
add_osm_feature(key="highway" , value="trunk")
hw_bog <- hw_bog %>% osmdata_sf()
hw_bog <- hw_bog$osm_points %>% select(osm_id)
leaflet() %>% addTiles() %>% addCircleMarkers(data=hw_bog , color="red") #caracas, 30 y 80
hw_bog_trunk <-  opq(bbox = getbb("Bogotá Colombia")) %>%
add_osm_feature(key="highway" , value="trunk")
hw_bog_trunk <- hw_bog_trunk %>% osmdata_sf()
hw_bog_trunk <- hw_bog_trunk$osm_points %>% select(osm_id)
leaflet() %>% addTiles() %>% addCircleMarkers(data=hw_bog_trunk , color="red") #caracas, 30 y 80
hw_bog_primary <-  opq(bbox = getbb("Bogotá Colombia")) %>%
add_osm_feature(key="highway" , value="primary")
hw_bog_primary <- hw_bog_primary %>% osmdata_sf()
hw_bog_primary <- hw_bog_primary$osm_points %>% select(osm_id)
leaflet() %>% addTiles() %>% addCircleMarkers(data=hw_bog_primary , color="red")
hw_bog <- rbind (hw_bog_trunk, hw_bog_primary)
leaflet() %>% addTiles() %>% addCircleMarkers(data=hw_bog , color="red")
hw_med_trunk <-  opq(bbox = getbb("Medellín Colombia")) %>%
add_osm_feature(key="highway" , value="trunk")
hw_med_trunk <- hw_med_trunk %>% osmdata_sf()
hw_med_trunk <- hw_med_trunk$osm_points %>% select(osm_id)
leaflet() %>% addTiles() %>% addCircleMarkers(data=hw_med_trunk , color="red")
hw_med_primary <-  opq(bbox = getbb("Medellín Colombia")) %>%
add_osm_feature(key="highway" , value="primary")
hw_med_primary <- hw_med_primary %>% osmdata_sf()
hw_med_primary <- hw_med_primary$osm_points %>% select(osm_id)
leaflet() %>% addTiles() %>% addCircleMarkers(data=hw_med_primary , color="red")
hw_med <- rbind (hw_med_trunk, hw_med_primary)
leaflet() %>% addTiles() %>% addCircleMarkers(data=hw_med , color="red")
highway_ciudades <- rbind(hw_bog, hw_med)
leaflet() %>% addTiles() %>% addCircleMarkers(data=highway_ciudades , color="red")
est_bogota <-read_sf("stores/estratosbogota/ManzanaEstratificacion.shp")
setwd("C:/Users/Camila Cely/Documents/GitHub/ProblemSet3_Cely_Ospina")
est_bogota <-read_sf("stores/estratosbogota/ManzanaEstratificacion.shp")
est_bogota <- st_transform(est_bogota, 4326)
est_bogota <- st_transform(est_bogota, 4326)
leaflet() %>% addTiles() %>% addPolygons(data=est_bogota)
View(est_bogota)
dist_highway_ciudades <- st_distance(x=tt_sf, y=highway_ciudades)
min_dist_highway_ciudades <- apply(dist_highway_ciudades,1,min)
tt_sf$dist_highway_ciudades <- min_dist_highway
head(tt_sf$dist_highway_ciudades)
dist_cbd <- st_distance(x=tt_sf, y=cbd)
dist_cbd <- st_distance(x=tt_barrios, y=cbd)
min_dist_cbd <- apply(dist_cbd,1,min)
tt_barrios$dist_cbd <- min_dist_cbd
head(tt_barrios$dist_cbd)
dist_cbd_ciudades <- st_distance(x=tt_sf, y=cbd)
min_dist_cbd_ciudades <- apply(dist_cbd_ciudades,1,min)
tt_barrios$dist_cbd_ciudades <- min_dist_cbd_ciudades
head(tt_sf$dist_cbd_ciudades)
dist_cbd_ciudades <- st_distance(x=tt_sf, y=cbd)
head (dist_cbd_ciudades)
leaflet() %>% addTiles() %>% addCircleMarkers(data=cbd , color="red")
min_dist_cbd_ciudades <- apply(dist_cbd_ciudades,1,min)
tt_sf$dist_cbd_ciudades <- min_dist_cbd_ciudades
head(tt_sf$dist_cbd_ciudades)
leaflet() %>% addTiles() %>% addCircleMarkers(data=highway_ciudades , color="red")
dist_highway_ciudades <- st_distance(x=tt_sf, y=highway_ciudades)
install.packages("progress")
pb <- progress_bar$new(total = 100)
f <- function() {
pb$tick(0)
Sys.sleep(3)
for (i in 1:100) {
pb$tick()
Sys.sleep(1 / 100)
}
}
f()
library(progress)
pb <- progress_bar$new(total = 100)
for (i in 1:100) {
pb$tick()
Sys.sleep(1 / 100)
}
intersect(names(test), names(train))
pb
highway_ciudades <- rbind(hw_bog_trunk, hw_med_trunk) #la estoy poniendo solo con trunk porque se demora muchisimo con trunk + primary
leaflet() %>% addTiles() %>% addCircleMarkers(data=highway_ciudades , color="red")
dist_highway_ciudades <- st_distance(x=tt_sf, y=highway_ciudades)
hw_bog_trunk_line <-  opq(bbox = getbb("Bogotá Colombia")) %>%
add_osm_feature(key="highway" , value="trunk")
class(hw_bog_trunk_line)
hw_bog_trunk_line <- hw_bog_trunk_line %>% osmdata_sf()
View(hw_bog_trunk_line)
hw_bog_trunk_line<- hw_bog_trunk$osm_polygons %>% select(osm_id)
hw_bog_trunk_line<- hw_bog_trunk$osm_lines %>% select(osm_id)
hw_bog_trunk_line <- hw_bog_trunk_line %>% osmdata_sf()
hw_bog_trunk_line <-  opq(bbox = getbb("Bogotá Colombia")) %>%
add_osm_feature(key="highway" , value="trunk")
hw_bog_trunk_line <- hw_bog_trunk_line %>% osmdata_sf()
hw_bog_trunk_line<- hw_bog_trunk$osm_lines %>% select(osm_id)
hw_bog_trunk_line<- hw_bog_trunk$osm_lines
hw_bog_trunk_line
colnames(tt_barrios)
View(tt_barrios)
tt_barrios <- tt_barrios %>% mutate (cundinamarca = if_else (tt_barrios$l2 == "Cundinamarca", 1, 0))
colnames (tt_sf)
tt_sf <- tt_sf %>% mutate (cundinamarca = if_else (tt_sf$l2 == "Cundinamarca", 1, 0))
summary (tt_barrios$bedrooms)
summary (tt_sf$bedrooms)
ggplot(data = tt_barrios , mapping = aes(x = bedrooms , y = price))+
geom_point(col = "tomato" , size = 0.75)
summary (tt_sf$bedrooms)
summary (tt_barrios$bedrooms)
ggplot(data = tt_barrios , mapping = aes(x = bedrooms , y = price))+
geom_point(col = "tomato" , size = 0.75)
tt_barrios <- tt_barrios %>% mutate (bed_0 = if_else (tt_barrios$bedrooms == 0, 1, 0))
tt_barrios <- tt_barrios %>% mutate (bed_1 = if_else (tt_barrios$bedrooms == 1, 1, 0))
tt_barrios <- tt_barrios %>% mutate (bed_2 = if_else (tt_barrios$bedrooms == 2, 1, 0))
tt_barrios <- tt_barrios %>% mutate (bed_0 = if_else (tt_barrios$bedrooms == 0, 1, 0))
tt_barrios <- tt_barrios %>% mutate (bed_1 = if_else (tt_barrios$bedrooms == 1, 1, 0))
tt_barrios <- tt_barrios %>% mutate (bed_2 = if_else (tt_barrios$bedrooms == 2, 1, 0))
tt_barrios <- tt_barrios %>% mutate (bed_3 = if_else (tt_barrios$bedrooms == 3, 1, 0))
tt_barrios <- tt_barrios %>% mutate (bed_more = if_else (tt_barrios$bedrooms >= 4, 1, 0))
tt_sf <- tt_sf %>% mutate (bed_0 = if_else (tt_sf$bedrooms == 0, 1, 0))
tt_sf <- tt_sf %>% mutate (bed_1 = if_else (tt_sf$bedrooms == 1, 1, 0))
tt_sf <- tt_sf %>% mutate (bed_2 = if_else (tt_sf$bedrooms == 2, 1, 0))
tt_sf <- tt_sf %>% mutate (bed_3 = if_else (tt_sf$bedrooms == 3, 1, 0))
tt_sf <- tt_sf %>% mutate (bed_more = if_else (tt_sf$bedrooms >= 4, 1, 0))
tt_sf <- tt_sf %>%
mutate (titlemin = str_to_lower(string = tt_sf$title))
tt_sf <- tt_sf %>%
mutate (descriptionmin = str_to_lower(string = tt_sf$description))
x1 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+m2" ## pattern
x2 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+mt"
x3 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+mts"
x4 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+mts2"
x5 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+mts 2"
x6 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+metros"
x7 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+metros+[:space:]+cuadrados"
x8 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+mt2"
x9 = "[:space:]+[:digit:]+[:punct:]+[:digit:]+[:space:]+m+²"
x10 = "[:space:]+[:digit:]+[:space:]+m2"
x11 = "[:space:]+[:digit:]+[:space:]+mts"
x12 = "[:space:]+[:digit:]+[:space:]+mts2"
x13 = "[:space:]+[:digit:]+[:space:]+mts 2"
x14 = "[:space:]+[:digit:]+[:space:]+metros"
x15 = "[:space:]+[:digit:]+[:space:]+metros+[:space:]+cuadrados"
x16 = "[:space:]+[:digit:]+[:space:]+mt2"
x17 = "[:space:]+[:digit:]+[:space:]+mt"
x18 = "[:space:]+[:digit:]+[:space:]+m+²"
x19 = "[:space:]+[:digit:]+m2"
x20 = "[:space:]+[:digit:]+mts"
x21 = "[:space:]+[:digit:]+mts2"
x22 = "[:space:]+[:digit:]+mts 2"
x23 = "[:space:]+[:digit:]+metros+[:space:]+cuadrados"
x24 = "[:space:]+[:digit:]+metros"
x25 = "[:space:]+[:digit:]+mt2"
x26 = "[:space:]+[:digit:]+mt 2"
x27 = "[:space:]+[:digit:]+m+²"
#imputamos los valores de area que estan NA con los patrones
tt_sf = tt_sf %>%
mutate(area = ifelse(is.na(area)==T,
str_extract(string=tt_sf$description , pattern=
paste0(x1,"|",x2,"|",x3,"|",x4,"|",x5,"|",x6,"|",x7,"|",x8,"|",x9,"|",x10,"|",
x11,"|",x12,"|",x13,"|",x14,"|",x15,"|",x16,"|",x17,"|",x18,"|",x19,"|",
x20,"|",x21,"|",x22,"|",x23,"|",x24,"|",x25,"|",x26,"|",x27)),
area))
#Complementamos a variable de area que ya tenemos
tt_sf$area<-str_remove_all(tt_sf$area,"m2")
tt_sf$area<-str_remove_all(tt_sf$area,"mts")
tt_sf$area<-str_remove_all(tt_sf$area,"mts2")
tt_sf$area<-str_remove_all(tt_sf$area,"mts 2")
tt_sf$area<-str_remove_all(tt_sf$area,"metros")
tt_sf$area<-str_remove_all(tt_sf$area,"mt2")
tt_sf$area<-str_remove_all(tt_sf$area,"mt 2")
tt_sf$area<-str_remove_all(tt_sf$area,"m+²")
tt_sf$area<-str_remove_all(tt_sf$area,"mt")
tt_sf$area<-str_remove_all(tt_sf$area,"metros cuadrados")
tt_sf$area<-str_remove_all(tt_sf$area, "[\n]")
tt_sf$area<-str_remove_all(tt_sf$area, "[ ]")
tt_sf$area<-str_replace_all(tt_sf$area, ",", ".")
tt_sf$area<-str_remove_all(tt_sf$area,"[:punct:]+[:digit:]")
tt_sf$area<-str_remove_all(tt_sf$area,"[:space:]")
tt_sf = tt_sf %>%
mutate(area = as.numeric(tt_sf$area))
table(is.na(tt_sf$area))
table(tt_sf$area)
sum(table(tt_sf$area))
view(tt_sf$area)
sum(table(tt_sf$area))
table(is.na(tt_sf$bathrooms)) #34343 NA
y1 = "[:space:]+[:digit:]+[:space:]+baños"
y2 = "[:space:]+[:digit:]+[:space:]+banos"
y3 = "[:space:]+[:digit:]+[:space:]+baos"
y4 = "[:space:]+[:digit:]+baños"
y5 = "[:space:]+[:digit:]+banos"
y6 = "[:space:]+con baño+[:space:]"
y7 = "[:space:]+un baño+[:space:]"
y8 = "[:space:]+dos baños+[:space:]"
y9 = "[:space:]+dos baños+[:punct:]"
y10= "[:space:]+tres baños+[:space:]"
y11= "[:space:]+tres baños+[:punct:]"
y12= "[:space:]+cuatro baños+[:space:]"
y13= "[:space:]+cuatro baños+[:punct:]"
#imputar los NA de baños con los patrones
tt_sf = tt_sf %>%
mutate(bathrooms = ifelse(is.na(bathrooms)==T,
str_extract(string=tt_sf$description , pattern=
paste0(y1,"|",y2,"|",y3,"|",y4,"|",y5,"|",y6,"|",y7,"|",y8,"|",y9,"|",y10,"|",y11,"|",y12,"|",y13)),
bathrooms))
table(is.na(tt_sf$bathrooms)) .
#Sacamos solo los numeros de las observaciones
tt_sf$bathrooms<-str_replace_all(tt_sf$bathrooms, pattern = "con" , replacement = "1")
tt_sf$bathrooms<-str_replace_all(tt_sf$bathrooms, pattern = "un" , replacement = "1")
tt_sf$bathrooms<-str_replace_all(tt_sf$bathrooms, pattern = "dos" , replacement = "2")
tt_sf$bathrooms<-str_replace_all(tt_sf$bathrooms, pattern = "tres" , replacement = "3")
tt_sf$bathrooms<-str_replace_all(tt_sf$bathrooms, pattern = "cuatro" , replacement = "4")
tt_sf$bathrooms<-str_remove_all(tt_sf$bathrooms,"baños")
tt_sf$bathrooms<-str_remove_all(tt_sf$bathrooms,"banos")
tt_sf$bathrooms<-str_remove_all(tt_sf$bathrooms,"baos")
tt_sf$bathrooms<-str_remove_all(tt_sf$bathrooms,"[:space:]")
tt_sf$bathrooms<-str_remove_all(tt_sf$bathrooms,"[:alpha:]")
tt_sf$bathrooms<-str_remove_all(tt_sf$bathrooms,"[:blank:]")
tt_sf$bathrooms<-str_remove_all(tt_sf$bathrooms,"[:punct:]")
tt_sf$bathrooms<-str_replace_all(tt_sf$bathrooms, ",", ".")
table(is.na(tt_sf$bathrooms))
tt_sf = tt_sf %>%
mutate(bathrooms = as.numeric(tt_sf$bathrooms))
table(is.na(tt_sf$bathrooms)) ##18824 NA, imputamos 15519
w1 = "piso+[:space:]+[:digit:]"
w2 = "[:space:]+piso+[:space:]+[:digit:]+[:punct]"
w3 = "primer piso"
w4 = "segundo piso"
w5 = "tercer piso"
w6 = "cuarto piso"
w7 = "quinto piso"
w8 = "sexto piso"
w9 = "septimo piso"
w10 = "octavo piso+"
w11 = "noveno piso"
w12 = "decimo piso"
w13 = "onceavo piso"
w14 = "doceavo piso"
w15 = "treceavo piso"
w16 = "catorceavo piso"
w17 = "quinceavo piso"
w18 = "dieciseisavo piso"
w19 = "diecisieteavo piso"
w20 = "dieciochoavo piso"
w21 = "diecinueveavo piso"
w22 = "veinteavo piso"
tt_sf = tt_sf %>%
mutate(nivel = str_extract(string=tt_sf$description , pattern= paste0(w1,"|",w2,"|",w3,"|",w4,"|",w5,"|",w6,"|",w7,"|",w8,"|",w9,"|",w10,"|",w11,"|",w12,"|",
w13,"|",w14,"|",w15,"|",w16,"|",w17,"|",w18,"|",w19,"|",w20,"|",w21,"|",w22)))
table(tt_sf$nivel)
table(is.na(tt_sf$nivel))
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "primer" , replacement = "1")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "segundo" , replacement = "2")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "tercer" , replacement = "3")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "cuarto" , replacement = "4")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "quinto" , replacement = "5")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "sexto" , replacement = "6")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "septimo" , replacement = "7")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "octavo" , replacement = "8")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "noveno" , replacement = "9")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "decimo" , replacement = "10")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "onceavo" , replacement = "11")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "doceavo" , replacement = "12")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "treceavo" , replacement = "13")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "catorceavo" , replacement = "14")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "quinceavo" , replacement = "15")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "dieciseisavo" , replacement = "16")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "diecisieteavo" , replacement = "17")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "dieciochoavo" , replacement = "18")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "diecinueveavo" , replacement = "19")
tt_sf$nivel<-str_replace_all(tt_sf$bathrooms, pattern = "veinteavo" , replacement = "20")
tt_sf$nivel<-str_remove_all(tt_sf$nivel,"piso")
tt_sf$nivel<-str_remove_all(tt_sf$nivel,"nivel")
tt_sf$nivel<-str_remove_all(tt_sf$nivel,"[:space:]")
tt_sf$nivel<-str_remove_all(tt_sf$nivel,"[:alpha:]")
tt_sf$nivel<-str_remove_all(tt_sf$nivel,"[:blank:]")
tt_sf$nivel<-str_remove_all(tt_sf$nivel,"[:punct:]")
tt_sf$nivel<-str_replace_all(tt_sf$nivel, ",", ".")
tt_sf = tt_sf %>%
mutate(nivel = as.numeric(tt_sf$nivel))
table(is.na(tt_sf$nivel)) #tiene 34343
summary(tt_sf$nivel)
table(is.na(tt_sf$nivel)) #tiene 34343
u1 = "[:space:]+penthouse+[:space:]"
u2 = "[:space:]+pent house+[:space:]"
u3 = "[:space:]+pent-house+[:space:]"
u4 = "[:space:]+penthouse+[:punct:]"
u5 = "[:space:]+pent house+[:punct:]"
u6 = "[:space:]+pent-house+[:punct:]"
tt_sf <- tt_sf %>%
mutate(penthouse = str_extract(string=tt_sf$description , pattern= paste0(u1,"|",u2,"|",u3,"|",u4,"|",u5,"|",u6)))
table(tt_sf$penthouse)
table(is.na(tt_sf$penthouse))
tt_sf <- tt_sf %>%
mutate(penthouse = if_else( is.na(penthouse)==TRUE,0,1))
summary(tt_sf$penthouse)
v1 = "[:space:]+terraza+[:space:]"
v2 = "[:space:]+tiene terraza+[:space:]"
v3 = "[:space:]+balcón+[:space:]"
v4 = "[:space:]+tiene balcon+[:space:]"
v5 = "[:space:]+balcn+[:space:]"
v6 = "[:space:]+tiene balcn+[:space:]"
v7 = "[:space:]+bbq+[:space:]"
v8 = "[:space:]+tiene bbq+[:space:]"
v9 = "[:space:]+terraza+[:punct:]"
v10= "[:space:]+balcón+[:punct:]"
v11= "[:space:]+balcon+[:punct:]"
v12= "[:space:]+balcn+[:punct:]"
v13= "[:space:]+bbq+[:punct:]"
#nueva variable
tt_sf <- tt_sf %>%
mutate(balcon = str_extract(string=tt_sf$description , pattern= paste0(v1,"|",v2,"|",v3,"|",v4,"|",v5,"|",v6,"|",
v7,"|",v8,"|",v9,"|",v10,"|",v11,"|",v12,"|",v13)))
table(tt_sf$balcon)
table(is.na(tt_sf$balcon))
tt_sf <- tt_sf %>%
mutate(balcon = if_else( is.na(balcon)==TRUE,0,1))
summary(tt_sf$balcon) #32% de las propiedades tiene balcon o semejante
e1 = "[:space:]+duplex+[:space:]"
e2 = "[:space:]+altillo+[:space:]"
e3 = "[:space:]+duplex+[:punct:]"
e4 = "[:space:]+altillo+[:punct:]"
#nueva variable
tt_sf <- tt_sf %>%
mutate(extras = str_extract(string=tt_sf$description , pattern= paste0(e1,"|",e2,"|",e3,"|",e4)))
table(tt_sf$extras)
table(is.na(tt_sf$extras))
tt_sf <- tt_sf %>%
mutate(extras = if_else( is.na(extras)==TRUE,0,1))
summary(tt_sf$extras) #3,1% de las propiedades son duplex o tienen altillo
t1 = "[:space:]+moderno+[:space:]"
t2 = "[:space:]+remodelado+[:space:]"
t3 = "[:space:]+renovado+[:space:]"
t4 = "[:space:]+moderno+[:punct:]"
t5 = "[:space:]+remodelado+[:punct:]"
t6 = "[:space:]+renovado+[:punct:]"
#nueva variable
tt_sf <- tt_sf %>%
mutate(renov = str_extract(string=tt_sf$description , pattern= paste0(t1,"|",t2,"|",t3,"|",t4,"|",t5,"|",t6)))
table(tt_sf$renov)
table(is.na(tt_sf$renov))
tt_sf <- tt_sf %>%
mutate(renov = if_else( is.na(renov)==TRUE,0,1))
summary(tt_sf$renov) #7% de las propiedades son remodeladas o semejante
vi1 = "[:space:]+vista+[:space:]"
vi2 = "[:space:]+exterior+[:space:]"
vi3 = "[:space:]+vista+[:punct:]"
vi4 = "[:space:]+exterior+[:punct:]"
#nueva variable
tt_sf <- tt_sf %>%
mutate(vista = str_extract(string=tt_sf$description , pattern= paste0(t1,"|",t2,"|",t3,"|",t4)))
table(tt_sf$vista)
table(is.na(tt_sf$vista))
tt_sf <- tt_sf %>%
mutate(vista = if_else( is.na(vista)==TRUE,0,1))
summary(tt_sf$vista) #4,9% de las propiedades tienen vista al exterior o semejante (y lo promocionan como algo destacable de la propiedad)
tt_sf <- tt_sf %>%
mutate(parq = str_extract(string=tt_sf$description , pattern= paste0(s1,"|",s2,"|",s3,"|",s4,"|",s5,"|",s6,"|",s7,"|",s8)))
table(tt_sf$parq)
table(is.na(tt_sf$parq))
tt_sf <- tt_sf %>%
mutate(parq = if_else( is.na(parq)==TRUE,0,1))
summary(tt_sf$parq) # 36% de las propiedades tienen parqueadero
s1 = "[:space:]+parqueadero+[:space:]"
s2 = "[:space:]+parqueaderos+[:space:]"
s3 = "[:space:]+parqueadero+[:punct:]"
s4 = "[:space:]+parqueaderos+[:punct:]"
s5 = "[:space:]+garaje+[:space:]"
s6 = "[:space:]+garajes+[:space:]"
s7 = "[:space:]+garaje+[:punct:]"
s8 = "[:space:]+garajes+[:punct:]"
#nueva variable
tt_sf <- tt_sf %>%
mutate(parq = str_extract(string=tt_sf$description , pattern= paste0(s1,"|",s2,"|",s3,"|",s4,"|",s5,"|",s6,"|",s7,"|",s8)))
table(tt_sf$parq)
table(is.na(tt_sf$parq))
tt_sf <- tt_sf %>%
mutate(parq = if_else( is.na(parq)==TRUE,0,1))
summary(tt_sf$parq) # 36% de las propiedades tienen parqueadero
r1 = "[:space:]+ascensor+[:space:]"
r2 = "[:space:]+ascensores+[:space:]"
r3 = "[:space:]+ascensor+[:punct:]"
r4 = "[:space:]+ascensores+[:punct:]"
#nueva variable
tt_sf <- tt_sf %>%
mutate(ascen = str_extract(string=tt_sf$description , pattern= paste0(r1,"|",r2,"|",r3,"|",r4)))
table(tt_sf$ascen)
table(is.na(tt_sf$ascen))
tt_sf <- tt_sf %>%
mutate(ascen = if_else( is.na(ascen)==TRUE,0,1))
summary(tt_sf$ascen) #15% de las propiedades tienen ascensor
summary (tt_barrios$bathrooms)
summary (tt_sf$bathrooms)
tt_barrios <- tt_barrios %>% mutate (bathrooms_c = bathrooms)
tt_sf <- tt_sf %>%
mutate(bathrooms_c = if_else(is.na(bathrooms)==TRUE,median(bathrooms),bathrooms))
summary (tt_barrios$bathrooms_c)
summary (tt_sf$bathrooms)
tt_sf <- tt_sf %>%
mutate(bathrooms_c = if_else(is.na(tt_sf$bathrooms)==TRUE,median(tt_sf$bathrooms),tt_sf$bathrooms))
summary (tt_sf$bathrooms_c)
tt_sf <- tt_sf %>% mutate (bathrooms_c = bathrooms)
tt_sf <- tt_sf %>%
mutate(bano = if_else(tt_sf$bathrooms>(mean(tt_sf$bathrooms,na.rm=T)), 1, 0))
summary (tt_sf$bano)
tt_barrios <- tt_barrios %>%
mutate(bano = if_else(tt_barrios$bathrooms>(mean(tt_barrios$bathrooms,na.rm=T)), 1, 0))
tt_texto <- select(filter(tt_sf),c(property_id, area, nivel, balcon, extras, renov, vista, parq, ascen, bano, area_more))
tt_barrios <- left_join(tt_barrios, tt_texto)
tt_barrios <- tt_barrios %>%
mutate(area_more = if_else(tt_barrios$area>(mean(tt_barrios$area,na.rm=T)), 1, 0))
tt_sf <- tt_sf %>%
mutate(area_more = if_else(tt_sf$area>(mean(tt_sf$area,na.rm=T)), 1, 0))
tt_texto <- select(filter(tt_sf),c(property_id, area, nivel, balcon, extras, renov, vista, parq, ascen, bano, area_more))
tt_barrios <- left_join(tt_barrios, tt_texto)
tt_barrios <- st_join(tt_barrios, tt_texto)
View(tt_barrios)
